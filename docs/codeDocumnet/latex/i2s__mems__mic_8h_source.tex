\hypertarget{i2s__mems__mic_8h_source}{}\doxysection{i2s\+\_\+mems\+\_\+mic.\+h}
\label{i2s__mems__mic_8h_source}\index{D:/Glasgow/CSEcaurse/realtime/project/GuitarTuner/src/i2s\_mems\_mic.h@{D:/Glasgow/CSEcaurse/realtime/project/GuitarTuner/src/i2s\_mems\_mic.h}}
\mbox{\hyperlink{i2s__mems__mic_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef I2S\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define I2S\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#define ALSA\_PCM\_NEW\_HW\_PARAMS\_API}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define SAMPLE\_RATE 8000}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <alsa/asoundlib.h>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <alsa/pcm.h>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <cstdint>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <errno.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_driver_callback_8h}{DriverCallback.h}}"{}}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{comment}{//buffer size}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define frames\_number 1024}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{static} \textcolor{keyword}{struct }snd\_params\{}
\DoxyCodeLine{21     snd\_pcm\_format\_t format = SND\_PCM\_FORMAT\_S32\_LE;}
\DoxyCodeLine{22     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} channels = 1;}
\DoxyCodeLine{23     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rate = \mbox{\hyperlink{i2s__mems__mic_8h_a4b76a0c2859cfd819a343a780070ee2b}{SAMPLE\_RATE}};}
\DoxyCodeLine{24 \} hwparams;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{class }\mbox{\hyperlink{class_i2_smic}{I2Smic}} \{}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{public}:}
\DoxyCodeLine{33     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_i2_smic_a2c43d8ebb97cb2672b092bd4491c495c}{open\_pcm}}();}
\DoxyCodeLine{34     }
\DoxyCodeLine{39     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_i2_smic_af15f84fbb4c90745e7fb335c4e4387a9}{set\_params}}(\textcolor{keywordtype}{void});}
\DoxyCodeLine{47     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_i2_smic_a8f1b56ec665bf56e7b7122856d3b9ad7}{close\_pcm}}();}
\DoxyCodeLine{48     }
\DoxyCodeLine{56     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_i2_smic_ad0b508eea18b041656260af1b2a32cbc}{run}}();}
\DoxyCodeLine{57     }
\DoxyCodeLine{63     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_i2_smic_a3bd8cc7ed4ac4548acb7250ad9078e9f}{registercallback}}(\mbox{\hyperlink{class_driver_callback}{DriverCallback}}* cb);}
\DoxyCodeLine{64     }
\DoxyCodeLine{69     \mbox{\hyperlink{class_i2_smic_abf75b3bc1849b98251121c405cc8df46}{\string~I2Smic}}() \{}
\DoxyCodeLine{70         this-\/>\mbox{\hyperlink{class_i2_smic_a8f1b56ec665bf56e7b7122856d3b9ad7}{close\_pcm}}();}
\DoxyCodeLine{71     \}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{keywordtype}{int} \mbox{\hyperlink{class_i2_smic_a7e05996981fa1fa7913018c3caea3db7}{get\_rc}}();}
\DoxyCodeLine{74 \textcolor{keyword}{private}:}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     snd\_pcm\_t *handle;}
\DoxyCodeLine{77     \textcolor{keyword}{const} \textcolor{keywordtype}{int} open\_mode = 0;}
\DoxyCodeLine{78     \textcolor{keyword}{const} snd\_pcm\_stream\_t stream = SND\_PCM\_STREAM\_CAPTURE;}
\DoxyCodeLine{79     \textcolor{keywordtype}{char} \textcolor{keyword}{const}* pcm\_name = \textcolor{stringliteral}{"{}plughw:2"{}};\textcolor{comment}{//sound device name}}
\DoxyCodeLine{80     snd\_pcm\_uframes\_t frames; }
\DoxyCodeLine{81     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} val;}
\DoxyCodeLine{82     }
\DoxyCodeLine{83     snd\_pcm\_hw\_params\_t *params;}
\DoxyCodeLine{84     snd\_pcm\_info\_t *info;}
\DoxyCodeLine{85    }
\DoxyCodeLine{86     \mbox{\hyperlink{class_driver_callback}{DriverCallback}}* callback;}
\DoxyCodeLine{87     \textcolor{keywordtype}{int} rc;}
\DoxyCodeLine{88     std::mutex readoutMtx;}
\DoxyCodeLine{89     \textcolor{keywordtype}{int} buffer[2][\mbox{\hyperlink{i2s__mems__mic_8h_a7ed3f7b6a56165fe7909839f1f459c3c}{frames\_number}}];}
\DoxyCodeLine{90     \textcolor{keywordtype}{unsigned} currentBufIdx = 0;}
\DoxyCodeLine{91 \};}
\DoxyCodeLine{92 }
\DoxyCodeLine{93 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
